{{- $is_desktop := eq .chezmoi.hostname "desktop" -}}
# set modifier
set $super Mod4
set $alt Mod1
set $shift Shift
set $ctrl Control

# set font
font pango: Noto Sans 10

# Use Mouse+$alt to drag floating windows to their wanted position
floating_modifier $alt

focus_follows_mouse no

default_border pixel 2

# No borders for monitoring windows
for_window [class="kitty"] border normal 2
for_window [class="kitty" title="self-monitoring"] border none
for_window [class="kitty" title="server-monitoring"] border none

for_window [class="Alacritty"] border normal 2
for_window [class="Alacritty" title="self-monitoring"] border none
for_window [class="Alacritty" title="server-monitoring"] border none

exec_always --no-startup-id $HOME/.config/polybar/launch.sh

{{- if $is_desktop }}
# assignments
assign [class="Spotify"] 2
assign [class="discord"] 2

# Don't need borders either
for_window [class="Spotify"] border none
for_window [class="discord"] border none

# Display stuff
# Also edit /usr/share/sddm/scripts/Xsetup
# Vertical lined up bottom 1680 offset, 1260 slightly higher, 840 middle lined up
exec --no-startup-id xrandr --output HDMI-0 --mode 3840x2160 --rate 60 --rotate right --pos 0x0 --output DP-0 --primary --mode 3840x2160 --rate 120 --pos 2160x1260 --output DP-2 --off
# exec --no-startup-id xrandr --output HDMI-0 --mode 3840x2160 --rate 60 --right-of DP-0 --output DP-0 --primary --mode 3840x2160 --rate 120 --output DP-2 --off
# Lower mouse sensitivity
exec --no-startup-id xinput set-prop 'Logitech Gaming Mouse G502' 'libinput Accel Speed' -0.5
{{- end }}
exec --no-startup-id $HOME/.config/i3/xidlehook.sh &
exec --no-startup-id picom -b
exec --no-startup-id redshift-gtk
exec --no-startup-id dunst
exec --no-startup-id ~/.fehbg

{{- if $is_desktop }}
{{- if .dresrv.use_domain }}
# Use sshfs if we're not in the local network, otherwise we are using NFS
exec --no-startup-id $HOME/.config/i3/mount-sshfs.sh &
{{- end }}
# Start stuff
exec --no-startup-id "spotify --force-device-scale-factor=1.5 &"
exec --no-startup-id discord &
exec --no-startup-id kitty --title self-monitoring tmuxinator start hjn &
exec --no-startup-id $HOME/.config/i3/ssh-monitoring.sh &
exec --no-startup-id $HOME/.config/i3/update-localip.sh &
exec --no-startup-id "i3-msg 'workspace 2; append_layout /home/andrei/.config/i3/workspace-secondary-rotated.json'"
exec --no-startup-id numlockx on &
{{- else }}
# Brightness and power buttons on laptop, install xfce4-power-manager
exec --no-startup-id xfce4-power-manager
exec --no-startup-id $HOME/.config/i3/mount-sshfs.sh &
# Set layout to tabbed by default
exec --no-startup-id i3-msg layout tabbed
{{- end }}
exec --no-startup-id setxkbmap -layout us,no
exec --no-startup-id firefox &
exec --no-startup-id alacritty &
{{- if $is_desktop }}
exec --no-startup-id "i3-msg 'workspace 1; append_layout /home/andrei/.config/i3/workspace-main.json'"

# Nvidia OC
exec --no-startup-id nvidia-settings -a "[gpu:0]/GPUGraphicsClockOffset[3]=50" -a "[gpu:0]/GPUMemoryTransferRateOffset[3]=1000"
{{- end }}

# kill focused window
bindsym $super+q kill
bindsym $alt+F4 kill
bindsym --release button2 kill

# start a terminal
bindsym $super+$shift+Return exec kitty
bindsym $super+Return exec alacritty
# Alacritty shortcuts
bindsym $ctrl+$alt+1 exec alacritty -e ssh andrei@DreSRV
bindsym $ctrl+$alt+2 exec alacritty -e ssh root@DreSRV
bindsym $ctrl+$alt+3 exec alacritty -e ssh andrei@dresrv.com

# start dmenu (a program launcher)
bindsym $super+d exec rofi -show drun

# alt-tab
bindsym $alt+Tab exec rofi -show window

# Rofi run
bindsym $super+$alt+r exec rofi -show run

# Turn off displays, delay for button release
bindsym $super+Pause exec sleep 1 && xset dpms force off

# Common apps
bindsym $super+$alt+f exec thunar
bindsym $super+$alt+p exec pycharm
bindsym $super+$alt+c exec code --new-window
bindsym $super+$alt+b exec firefox
bindsym $super+$alt+$shift+b exec chromium

set $up Up
set $down Down
set $left Left
set $right Right

# change focus
bindsym $super+$left focus left
bindsym $super+$down focus down
bindsym $super+$up focus up
bindsym $super+$right focus right

# move focused window
bindsym $super+$shift+$left move left
bindsym $super+$shift+$down move down
bindsym $super+$shift+$up move up
bindsym $super+$shift+$right move right

# split in horizontal orientation
bindsym $super+h split h

# split in vertical orientation
bindsym $super+v split v

# enter fullscreen mode for the focused container
bindsym $super+f fullscreen toggle

# change container layout (stacked, tabbed, toggle split)
bindsym $super+s layout stacking
bindsym $super+w layout tabbed
bindsym $super+e layout toggle split

# toggle tiling / floating
bindsym $super+space floating toggle

# change focus between tiling / floating windows
bindsym $super+$shift+space focus mode_toggle

# focus the parent container
bindsym $super+a focus parent

# focus the child container
bindsym $super+$shift+a focus child

# move the currently focused window to the scratchpad
bindsym $super+$shift+minus move scratchpad

# Show the next scratchpad window or hide the focused scratchpad window.
# If there are multiple scratchpad windows, this command cycles through them.
bindsym $super+minus scratchpad show

# Screenshots
bindsym $super+$shift+s --release exec "scrot -s $HOME/Pictures/Screenshots/$(date +%F_%T).png -e 'xclip -selection c -t image/png < $f'"
bindsym Print exec "scrot $HOME/Pictures/Screenshots/$(date +%F_%T).png -e 'xclip -selection c -t image/png < $f'"
bindsym $shift+Print exec "scrot -u $HOME/Pictures/Screenshots/$(date +%F_%T).png -e 'xclip -selection c -t image/png < $f'"

# Lock screen and turn monitors off after 30 seconds, requires -git version
bindsym $super+l exec "$HOME/.local/bin/my-screenlock"

# switch to workspace
bindsym $super+Tab workspace next
bindsym $super+$shift+Tab workspace prev
bindsym $super+$ctrl+Right move window to workspace next
bindsym $super+$ctrl+Left move window to workspace prev
bindsym $super+$alt+$ctrl+Right move container to workspace next
bindsym $super+$alt+$ctrl+Left move container to workspace prev
bindsym $super+1 workspace 1
bindsym $super+2 workspace 2
bindsym $super+3 workspace 3
bindsym $super+4 workspace 4
bindsym $super+5 workspace 5
bindsym $super+6 workspace 6
bindsym $super+7 workspace 7
bindsym $super+8 workspace 8
bindsym $super+9 workspace 9
bindsym $super+$ctrl+1 move container to workspace 1
bindsym $super+$ctrl+2 move container to workspace 2
bindsym $super+$ctrl+3 move container to workspace 3
bindsym $super+$ctrl+4 move container to workspace 4
bindsym $super+$ctrl+5 move container to workspace 5
bindsym $super+$ctrl+6 move container to workspace 6
bindsym $super+$ctrl+7 move container to workspace 7
bindsym $super+$ctrl+8 move container to workspace 8
bindsym $super+$ctrl+9 move container to workspace 9

# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $super+$shift+r restart

# exit i3
bindsym $super+$shift+e exec "i3-nagbar -f 'pango:Noto Sans:20' -t warning -m 'Really, exit?' -b 'Yes' 'i3-msg exit'"

# resize window
mode "resize" {
    # Big steps
    bindsym $left resize shrink width 20 px or 5 ppt
    bindsym $down resize shrink height 20 px or 5 ppt
    bindsym $up resize grow height 20 px or 5 ppt
    bindsym $right resize grow width 20 px or 5 ppt
    # Fine adjustment
    bindsym $shift+$left resize shrink width 5 px
    bindsym $shift+$down resize shrink height 5 px
    bindsym $shift+$up resize grow height 5 px
    bindsym $shift+$right resize grow width 5 px

    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $super+r mode "resize"


##### Pulse Audio controls #####
bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ +1%
bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume @DEFAULT_SINK@ -1%
bindsym XF86AudioMute exec --no-startup-id pactl set-sink-mute @DEFAULT_SINK@ toggle

##### Media controls #####
bindsym XF86AudioPlay exec "playerctl --ignore-player=chromium,firefox play-pause"
bindsym XF86AudioNext exec "playerctl --ignore-player=chromium,firefox next"
bindsym XF86AudioPrev exec "playerctl --ignore-player=chromium,firefox previous"

for_window [class="Pavucontrol"] floating enable; border normal
for_window [class="jetbrains-toolbox"] floating enable; border none
for_window [class="gnome-calculator"] floating enable; border none
# Jetbrains splash window
for_window [class="jetbrains-\w+" title="^win0$"] floating enable; border none
# Evaluation window
for_window [class="jetbrains-\w+" title="\w+\sEvaluation"] floating enable; border normal
# PiP
for_window [class="(firefox|chromium)" title="(?i)^Picture(\s|-)in(\s|-)Picture$"] border none

##### i3 with KDE stuff #####
# for_window [title="Desktop â€” Plasma"] kill; floating enable; border none
# for_window [class="plasmashell"] floating enable;
# for_window [class="Plasma"] floating enable; border none
# for_window [title="plasma-desktop"] floating enable; border none
# for_window [title="win7"] floating enable; border none
# for_window [class="krunner"] floating enable; border none
# for_window [class="Kmix"] floating enable; border none
# for_window [class="Klipper"] floating enable; border none
# for_window [class="Plasmoidviewer"] floating enable; border none
# for_window [class="(?i)*nextcloud*"] floating disable
# for_window [class="plasmashell" window_type="notification"] floating enable, border none, move down 950, move right 1630
# no_focus [class="plasmashell" window_type="notification"] 
