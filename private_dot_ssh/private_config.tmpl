{{- $home := .chezmoi.homeDir -}}
{{- $general_keys := list ".ssh/id_ed25519" ".ssh/desktop_ed25519" ".ssh/laptop_ed25519" -}}
{{- $cosandr_keys := list ".ssh/id_ed25519.cosandr" ".ssh/desktop_ed25519.cosandr" ".ssh/laptop_ed25519.cosandr" -}}
{{- if stat (joinPath $home ".ssh/conf.d") }}
Include conf.d/*
{{- end }}
{{- if .is.windows }}
XAuthLocation "C:/Program Files/VcXsrv/xauth.exe"
{{- else if .is.mac }}
XAuthLocation /opt/X11/bin/xauth

Host *
   UseKeychain yes
   AddKeysToAgent yes
{{- end }}

{{- if exec "ssh" "-o" "WarnWeakCrypto=no" "-V" }}
WarnWeakCrypto no
{{- end }}

Host gitlab.dresrv.com
    HostName gitlab.dresrv.com
    User git
    PreferredAuthentications publickey
    IdentitiesOnly yes
{{- range $k := $general_keys }}
{{- $fp := joinPath $home $k }}
{{- if or (stat $fp) (stat (print $fp ".pub")) }}
    IdentityFile ~/{{ $k }}
{{- end }}
{{- end }}

Host github.com
    HostName github.com
    User git
    PreferredAuthentications publickey
    IdentitiesOnly yes
{{- range $k := $cosandr_keys }}
{{- $fp := joinPath $home $k }}
{{- if or (stat $fp) (stat (print $fp ".pub")) }}
    IdentityFile ~/{{ $k }}
{{- end }}
{{- end }}
