{{- $is_windows := eq .chezmoi.os "windows" -}}
{{- $is_desktop :=  eq .chezmoi.hostname "desktop" }}
{{- $is_laptop :=  eq .chezmoi.hostname "laptop" }}
{{- $is_srv :=  eq .chezmoi.hostname "DreSRV" }}
{{- $is_work := eq .chezmoi.hostname .work.ws_name -}}
{{- $is_pi :=  eq .chezmoi.hostname "drepi" }}
{{- $is_root := eq .chezmoi.username "root" }}
{{- $is_mac := eq .chezmoi.os "darwin" -}}
{{- if $is_windows }}
XAuthLocation "C:/Program Files/VcXsrv/xauth.exe"
{{- end }}
{{- if $is_mac }}
XAuthLocation /opt/X11/bin/xauth

Host *
   UseKeychain yes
   AddKeysToAgent yes
   IdentityFile ~/.ssh/id_ed25519
{{ end }}

{{- if not $is_work }}
Host DreSRV
    HostName {{ .dresrv.local_ip }}
{{- if and (not $is_srv) (not $is_windows) }}
    ControlPath ~/.ssh/cm-%r@%h:%p
    ControlMaster auto
    ControlPersist 10m
{{- end }}

Host dresrv.com
{{- if .dresrv.use_domain }}
    HostName {{ .dresrv.domain }}
    Port {{ .dresrv.ssh_port }}
{{- else }}
    HostName {{ .dresrv.local_ip }}
{{- end }}
{{- if and (not $is_srv) (not $is_windows) }}
    ControlPath ~/.ssh/cm-%r@%h:%p
    ControlMaster auto
    ControlPersist 10m
{{- end }}

{{ if not $is_srv -}}
Host srv-boot
    HostName {{ .dresrv.local_ip }}
    User root
    Port 2222

Host DreSRV-A
    HostName {{ .dresrv.local_ip }}
    User andrei
    ForwardAgent yes
{{- if and (not $is_windows) (not $is_mac) }}
    RemoteForward /run/user/1000/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent.extra
{{- end }}

Host DreSRV-X
    HostName {{ .dresrv.local_ip }}
    ForwardX11 yes
    ForwardX11Trusted yes
{{- if $is_windows }}
    RequestTTY yes
    RemoteCommand env GDK_SCALE=2 GDK_DPI_SCALE=0.75 QT_SCREEN_SCALE_FACTORS=2 QT_AUTO_SCREEN_SCALE_FACTOR=0 zsh
{{- end }}

Host dresrv.com-A
{{- if .dresrv.use_domain }}
    HostName {{ .dresrv.domain }}
    Port {{ .dresrv.ssh_port }}
{{- else }}
    HostName {{ .dresrv.local_ip }}
{{- end }}
    User andrei
    ForwardAgent yes
{{- if and (not $is_windows) (not $is_mac) }}
    RemoteForward /run/user/1000/gnupg/S.gpg-agent /run/user/1000/gnupg/S.gpg-agent.extra
{{- end }}
{{- end }} {{/* {{- if not $is_srv }} */}}

Host srvsim
    HostName 192.168.122.6
    User root
{{- if not $is_srv }}
    ProxyJump DreSRV
{{- end }}

Host srvsim-boot
    HostName 192.168.122.6
    Port 2222
    User root
{{- if not $is_srv }}
    ProxyJump DreSRV
{{- end }}

Host romsto
    HostName {{ .romsto.domain }}
    Port {{ .romsto.ssh_port }}

Host romrt
    HostName {{ .romrt.domain }}
    User {{ .romrt.ssh_user }}
    Port {{ .romrt.ssh_port }}

Host romrt-socks
    HostName {{ .romrt.domain }}
    User {{ .romrt.ssh_user }}
    Port {{ .romrt.ssh_port }}
    DynamicForward 4321
    ExitOnForwardFailure yes
    TCPKeepAlive yes
{{- if not $is_pi }}

Host drepi
    HostName 10.0.0.3
    User pi
    ForwardAgent yes

Host romvm
    HostName 10.1.1.33
    ProxyJump romsto
    ForwardAgent yes

Host ws
    HostName 192.168.1.43
    User andrei
    ForwardAgent yes

Host ws-socks
    HostName 192.168.1.43
    User andrei
    DynamicForward 5555
    ExitOnForwardFailure yes
    TCPKeepAlive yes

Host ws-boot
    HostName 192.168.1.43
    Port 2222
    User root
    IdentityFile ~/.ssh/id_rsa
{{- end }} {{/* {{- if not $is_work }} */}}

Host {{ .work.git_url }}
    HostName {{ .work.git_url }}
    User git
    PreferredAuthentications publickey
    IdentitiesOnly yes
{{- if $is_mac }}
    IdentityFile ~/.ssh/id_rsa.work
{{- else if $is_desktop }}
    IdentityFile ~/.ssh/id_rsa
{{- else }}
    IdentityFile ~/.ssh/mac_rsa.work
    IdentityFile ~/.ssh/desktop_rsa
{{- end }}
{{- end }} {{/* {{- if not $is_pi }} */}}

Host github.com
    HostName github.com
    User git
    PreferredAuthentications publickey
    IdentitiesOnly yes
{{- if or $is_desktop $is_laptop $is_mac }}
    IdentityFile ~/.ssh/id_ed25519.cosandr
{{- else }}
    IdentityFile ~/.ssh/desktop_ed25519.cosandr
    IdentityFile ~/.ssh/mac_ed25519.cosandr
{{- end }}

Host github.com-atgb
    HostName github.com
    User git
    PreferredAuthentications publickey
    IdentitiesOnly yes
{{- if or $is_desktop $is_laptop $is_mac }}
    IdentityFile ~/.ssh/id_ed25519.atgb
{{- else }}
    IdentityFile ~/.ssh/desktop_ed25519.atgb
    IdentityFile ~/.ssh/mac_ed25519.atgb
{{- end }}
{{ if and (not $is_root) (or $is_desktop $is_laptop) -}}
Host prom-tunnel
{{- if .dresrv.use_domain }}
    HostName {{ .dresrv.domain }}
    Port {{ .dresrv.ssh_port }}
    LocalForward localhost:8101 localhost:8100
{{- else }}
    HostName {{ .dresrv.local_ip }}
{{- end }}
    User prom-tunnel
    IdentityFile ~/.ssh/id_ed25519.prom
    ExitOnForwardFailure yes
    ControlMaster no
    TCPKeepAlive yes
{{- if $is_desktop }}
    RemoteForward localhost:17766 localhost:7766
{{- else if $is_laptop }}
    RemoteForward localhost:27766 localhost:7766
{{- end }}
{{- end }} {{/* {{ if and (not $is_root) (or $is_desktop $is_laptop) -}} */}}
